---
layout: post
title: p6Spy，SQL Profiler接合Spring监控Hibernate的sql语句
tags:
- Java
- Technique
status: publish
type: post
published: true
meta:
  views: '780'
---
<p>1、<a href="http://www.p6spy.com">p6Spy</a></p> <p>1).下载p6spy-install.zip</p> <p>2).将p6spy.jar放到应用的lib目录下,将spy.properties放到WEB-INFclasses目录下</p> <p>3).修改spy.properties的44行</p> <p># mysql Connector/J driver</p> <p>realdriver=com.mysql.jdbc.Driver //Mysql数据库驱动</p> <p>4).修改spy.properties样本的第168行，将spy.log放到比较好找的位置：</p> <p>logfile = E:/spy.log</p> <p>5).在spring配置文件中配置如下:</p> <p><code>&lt;pre lang="Java" line="1"&gt;</code></p> <p>&lt;bean id="dataSource" class="com.mchange.v2.c3p0.ComboPooledDataSource"&gt;</p> <p>&lt;!-- &lt;property name="driverClass"&gt;&lt;value&gt;net.sourceforge.jtds.jdbc.Driver&lt;/value&gt;&lt;/property&gt; --&gt;</p> <p>&lt;property name="driverClass"&gt;&lt;value&gt;com.p6spy.engine.spy.P6SpyDriver&lt;/value&gt;&lt;/property&gt;</p> <p>&lt;property name="jdbcUrl"&gt;&lt;value&gt;${read.jdbcUrl}&lt;/value&gt;&lt;/property&gt;</p> <p>&lt;property name="user"&gt;&lt;value&gt;${read.user}&lt;/value&gt;&lt;/property&gt;</p> <p>&lt;property name="password"&gt;&lt;value&gt;${read.password}&lt;/value&gt;&lt;/property&gt;</p> <p>&lt;property name="minPoolSize"&gt;&lt;value&gt;10&lt;/value&gt;&lt;/property&gt;</p> <p>&lt;property name="maxPoolSize"&gt;&lt;value&gt;30&lt;/value&gt;&lt;/property&gt;</p> <p>&lt;property name="initialPoolSize"&gt;&lt;value&gt;10&lt;/value&gt;&lt;/property&gt;</p> <p>&lt;property name="maxIdleTime"&gt;&lt;value&gt;28000&lt;/value&gt;&lt;/property&gt;</p> <p>&lt;property name="idleConnectionTestPeriod"&gt;&lt;value&gt;28000&lt;/value&gt;&lt;/property&gt;</p> <p>&lt;/bean&gt;</p> <p>&lt;/pre&gt;</p> <p align="left"><script type="text/javascript"><!--
google_ad_client = "ca-pub-6960703437272224";
/* blog_header_menu_link_468&#42;15 */
google_ad_slot = "5788462734";
google_ad_width = 468;
google_ad_height = 15;
//-->
</script><script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p> <p>2、<a href="http://heanet.dl.sourceforge.net/sourceforge/sqlprofiler/sqlprofiler-0.3-src.zip">SQL Profiler</a></p> <p>1).下载<a href="http://heanet.dl.sourceforge.net/sourceforge/sqlprofiler/sqlprofiler-0.3-src.zip">sqlprofiler-0.3-bin.zip</a></p> <p>2). 解压，将spy.properties下面内容复制到先前的spy.properties替换相应地配置</p> <p>3).将sqlprofile.jar放入webinf下.</p> <p>4).java –jar sqlprofiler.jar打开命令控制台</p> <p>附录几张截图：</p> <p><a href="/assets/uploads/2009/04/image4.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/uploads/2009/04/image-thumb4.png" width="388" height="323"></a></p> <p>图一.sqlProfiler给出了详细的sql语句（附上了查询条件的查询语句，可以直接放到Navicat等客户端工具上使用）</p><!--more--><a href="/assets/uploads/2009/04/image5.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/uploads/2009/04/image-thumb5.png" width="386" height="303"></a>  <p align="left"><script type="text/javascript"><!--
google_ad_client = "ca-pub-6960703437272224";
/* Text/Image_300&#42;250 */
google_ad_slot = "3868186516";
google_ad_width = 300;
google_ad_height = 250;
//-->
</script><script type="text/javascript" src="http://pagead2.googlesyndication.com/pagead/show_ads.js">
</script></p> <p>图二.sqlProfiler可以查看不同的日志级别的输出，接合Log4j来实现的</p> <p><a href="/assets/uploads/2009/04/image6.png"><img style="border-right-width: 0px; display: inline; border-top-width: 0px; border-bottom-width: 0px; border-left-width: 0px" title="image" border="0" alt="image" src="/assets/uploads/2009/04/image-thumb6.png" width="381" height="348"></a></p> <p>图三.sqlProfiler比较强大的是可以使用它分析系统的bottleneck，并提高生成数据库index的功能</p> <p>就写这么多。此外还以使用IronTracker等工具进行SQL和数据的tuning.大家可以自己尝试，欢迎交流！</p>
