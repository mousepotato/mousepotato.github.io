<!DOCTYPE html>
<html>
<head>
<meta charset="utf-8">
<title>Reservoir Sampling</title>
</head>
<body>
<div class="md-section-divider"></div>

<div class="md-section-divider"></div>

<h2 id="reservoir-sampling">Reservoir Sampling</h2>

<div class="md-section-divider"></div>

<h3 id="1-介绍">1. 介绍</h3>

<blockquote class="white-blockquote">
  <p>Reservoir Sampling 中文翻译是水塘抽样/蓄水池抽样, 之的是一组随机抽样算法, 而不是某一个具体的算法. 这类算法主要用于解决这样一个问题: 当样本总体很大或者是在数据流上进行采样的时候, 我们往往无法预知总体的样本实例个数 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5013-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-22984" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.937em 1000.002em 2.681em -0.444em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-22985"><span class="mi" id="MathJax-Span-22986" style="font-family: STIXGeneral-Italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.691em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5013">n</script> . 那么Reservoir Sampling 就是这样一组算法, 即使不知道 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5014-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-22987" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.937em 1000.002em 2.681em -0.444em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-22988"><span class="mi" id="MathJax-Span-22989" style="font-family: STIXGeneral-Italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.691em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5014">n</script>, 也能保证每个样本实例被采样到的概率依然相等. 下面是一个其中一个非常典型的在线(online)线性算法, 可以用于数据无法装入内存或者在流数据上使用。</p>
</blockquote>

<div class="md-section-divider"></div>

<h3 id="2-实现">2. 实现</h3>

<p>从 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5015-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-22990" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.937em 1000.002em 2.681em -0.444em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-22991"><span class="mi" id="MathJax-Span-22992" style="font-family: STIXGeneral-Italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.691em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5015">n</script> 个数据里随机取 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5016-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-22993" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.444em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-22994"><span class="mi" id="MathJax-Span-22995" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.003em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5016">k</script> 个数</p>

<ol>
<li>用前 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5017-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-22996" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.444em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-22997"><span class="mi" id="MathJax-Span-22998" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.003em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5017">k</script> 个数据组成一个reservoir；</li>
<li>从 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5018-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-22999" style="width: 2.78em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.185em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.731em -0.444em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23000"><span class="mi" id="MathJax-Span-23001" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-23002" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mn" id="MathJax-Span-23003" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.066em; vertical-align: -0.122em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5018">k+1</script> 开始，对于第 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5019-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23004" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23005"><span class="mi" id="MathJax-Span-23006" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5019">i</script> 个元素，随机产生一个 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5020-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23007" style="width: 2.433em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.937em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.83em -0.345em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23008"><span class="mo" id="MathJax-Span-23009" style="font-family: STIXGeneral-Regular;">[</span><span class="mn" id="MathJax-Span-23010" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-23011" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-23012" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">i</span><span class="mo" id="MathJax-Span-23013" style="font-family: STIXGeneral-Regular;">]</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.191em; vertical-align: -0.247em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5020">[1, i]</script> 之间的数 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5021-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23014" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.879em -0.543em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23015"><span class="mi" id="MathJax-Span-23016" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.191em; vertical-align: -0.309em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5021">j</script>，如果  <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5022-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23017" style="width: 2.631em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.879em -0.543em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23018"><span class="mi" id="MathJax-Span-23019" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-23020" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">≤</span><span class="mi" id="MathJax-Span-23021" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.253em; vertical-align: -0.309em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5022">j \leq k</script>，则reservoir里第 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5023-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23022" style="width: 0.449em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.879em -0.543em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23023"><span class="mi" id="MathJax-Span-23024" style="font-family: STIXGeneral-Italic;">j<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.191em; vertical-align: -0.309em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5023">j</script> 个元素就被 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5024-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23025" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23026"><span class="mi" id="MathJax-Span-23027" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5024">i</script> 替换掉。直到 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5025-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23028" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.937em 1000.002em 2.681em -0.444em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23029"><span class="mi" id="MathJax-Span-23030" style="font-family: STIXGeneral-Italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.691em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5025">n</script> 个数据都被试过。</li>
</ol>

<div class="md-section-divider"></div>

<h3 id="3-证明">3. 证明</h3>

<ul>
<li><p>上面这个算法的步骤是这样: </p>

<ol><li><p>从总体 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5026-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23031" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.937em 1000.002em 2.681em -0.444em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23032"><span class="mi" id="MathJax-Span-23033" style="font-family: STIXGeneral-Italic;">n</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.691em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5026">n</script> 中抽取前面的 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5027-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23034" style="width: 0.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.444em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23035"><span class="mi" id="MathJax-Span-23036" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.003em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5027">k</script> 个实例放入预制的数组中, 这个数组就是我们最后要返回的抽样结果;</p></li>
<li><p>对于后面的所有样本实例, 从 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5028-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23037" style="width: 4.764em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.772em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.731em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23038"><span class="mi" id="MathJax-Span-23039" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-23040" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mi" id="MathJax-Span-23041" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-23042" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mn" id="MathJax-Span-23043" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.066em; vertical-align: -0.122em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5028">i = k+1</script> 个开始, 我们对每一个生成一个 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5029-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23044" style="width: 2.433em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.937em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.879em -0.345em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23045"><span class="mo" id="MathJax-Span-23046" style="font-family: STIXGeneral-Regular;">[</span><span class="mn" id="MathJax-Span-23047" style="font-family: STIXGeneral-Regular;">0</span><span class="mo" id="MathJax-Span-23048" style="font-family: STIXGeneral-Regular;">,</span><span class="mi" id="MathJax-Span-23049" style="font-family: STIXGeneral-Italic; padding-left: 0.201em;">i</span><span class="mo" id="MathJax-Span-23050" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.191em; vertical-align: -0.309em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5029">[0, i)</script> 的随机数 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5030-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23051" style="width: 1.887em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.491em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23052"><span class="mi" id="MathJax-Span-23053" style="font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-23054" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-23055" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.003em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5030">rnd</script>, 若 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5031-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23056" style="width: 4.07em; display: inline-block;"><span style="display: inline-block; position: relative; width: 3.227em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23057"><span class="mi" id="MathJax-Span-23058" style="font-family: STIXGeneral-Italic;">r<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mi" id="MathJax-Span-23059" style="font-family: STIXGeneral-Italic;">n</span><span class="mi" id="MathJax-Span-23060" style="font-family: STIXGeneral-Italic;">d<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.052em;"></span></span><span class="mo" id="MathJax-Span-23061" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">&lt;</span><span class="mi" id="MathJax-Span-23062" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.003em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5031">rnd < k</script>, 那我们就用当前的val替换掉 result[i].</p></li></ol></li>
<li><p>这样做为什么能保证每个实例被抽到的概率当等而且概率为 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5032-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23063" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em 1000.002em 2.979em -0.345em); top: -2.478em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23064"><span class="mfrac" id="MathJax-Span-23065" style="padding-left: 0.102em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px;"><span style="position: absolute; clip: rect(1.838em 1000.002em 2.631em -0.444em); top: -2.875em; left: 50%; margin-left: -0.146em;"><span class="mi" id="MathJax-Span-23066" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span><span style="position: absolute; clip: rect(2.036em 1000.002em 2.631em -0.444em); top: -2.13em; left: 50%; margin-left: -0.146em;"><span class="mi" id="MathJax-Span-23067" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.238em; left: 0.002em;"><span style="border-left-width: 0.449em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.691em; vertical-align: -0.497em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5032">\frac{k}{n}</script> 呢?</p></li>
</ul>

<p>可以这样分析: 我们知道对于第 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5033-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23068" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23069"><span class="mi" id="MathJax-Span-23070" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5033">i</script> 个实例, 当算法遇到他的时候, 他被选中进入 result 的概率是 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5034-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23071" style="width: 0.895em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.697em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.441em 1000.002em 3.028em -0.345em); top: -2.478em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23072"><span class="mfrac" id="MathJax-Span-23073" style="padding-left: 0.102em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px;"><span style="position: absolute; clip: rect(1.838em 1000.002em 2.631em -0.444em); top: -2.875em; left: 50%; margin-left: -0.146em;"><span class="mi" id="MathJax-Span-23074" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span><span style="position: absolute; clip: rect(1.887em 1000.002em 2.631em -0.394em); top: -2.13em; left: 50%; margin-left: -0.097em;"><span class="mi" id="MathJax-Span-23075" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.238em; left: 0.002em;"><span style="border-left-width: 0.449em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.753em; vertical-align: -0.559em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5034">\frac{k}{i}</script>, 那么他依然出现在最后的 result 的情况是, <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5035-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23076" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23077"><span class="mi" id="MathJax-Span-23078" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5035">i</script> 后面所有的实例都没有取代掉他, <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5036-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23079" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23080"><span class="mi" id="MathJax-Span-23081" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5036">i</script> 后面任何第 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5037-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23082" style="width: 2.433em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.937em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23083"><span class="mi" id="MathJax-Span-23084" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span class="mo" id="MathJax-Span-23085" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">&gt;</span><span class="mi" id="MathJax-Span-23086" style="font-family: STIXGeneral-Italic; padding-left: 0.3em;">i</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.003em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5037">t > i</script> 个实例取代掉他的概率是 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5038-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23087" style="width: 1.838em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.441em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.044em 1000.002em 3.078em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23088"><span class="mo" id="MathJax-Span-23089" style="font-family: STIXGeneral-Regular;">(</span><span class="mfrac" id="MathJax-Span-23090" style="padding-left: 0.102em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 0.499em; height: 0px;"><span style="position: absolute; clip: rect(3.177em 1000.002em 4.417em -0.444em); top: -4.66em; left: 50%; margin-left: -0.196em;"><span class="mfrac" id="MathJax-Span-23091" style="padding-left: 0.102em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 0.35em; height: 0px;"><span style="position: absolute; clip: rect(1.987em 1000.002em 2.631em -0.444em); top: -2.825em; left: 50%; margin-left: -0.097em;"><span class="mi" id="MathJax-Span-23092" style="font-size: 50%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span><span style="position: absolute; clip: rect(2.036em 1000.002em 2.631em -0.444em); top: -2.23em; left: 50%; margin-left: -0.097em;"><span class="mi" id="MathJax-Span-23093" style="font-size: 50%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.188em; left: 0.002em;"><span style="border-left-width: 0.35em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 4.02em;"></span></span><span style="position: absolute; clip: rect(1.838em 1000.002em 2.631em -0.444em); top: -2.081em; left: 50%; margin-left: -0.146em;"><span class="mi" id="MathJax-Span-23094" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.238em; left: 0.002em;"><span style="border-left-width: 0.499em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-23095" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.316em; vertical-align: -0.559em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5038">(\frac{\frac{k}{t}}{k})</script>. <strong>可以这样理解, <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5039-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23096" style="width: 0.435em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.339em; height: 0px; font-size: 130%;"><span style="position: absolute; clip: rect(1.925em 1000.002em 2.743em -0.382em); top: -2.594em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23097"><span class="mi" id="MathJax-Span-23098" style="font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span></span><span style="display: inline-block; width: 0px; height: 2.599em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.878em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5039">t</script> 实例被选中的概率 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5040-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23099" style="width: 1.829em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.397em; height: 0px; font-size: 130%;"><span style="position: absolute; clip: rect(1.541em 1000.002em 3.079em -0.382em); top: -2.594em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23100"><span class="mo" id="MathJax-Span-23101" style="font-family: STIXGeneral-Regular;">(</span><span class="mfrac" id="MathJax-Span-23102" style="padding-left: 0.099em; padding-right: 0.099em;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px;"><span style="position: absolute; clip: rect(1.925em 1000.002em 2.695em -0.43em); top: -2.93em; left: 50%; margin-left: -0.19em;"><span class="mi" id="MathJax-Span-23103" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.55em;"></span></span><span style="position: absolute; clip: rect(2.022em 1000.002em 2.695em -0.382em); top: -2.209em; left: 50%; margin-left: -0.094em;"><span class="mi" id="MathJax-Span-23104" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.55em;"></span></span><span style="position: absolute; clip: rect(0.868em 1000.002em 1.204em -0.43em); top: -1.296em; left: 0.002em;"><span style="border-left-width: 0.483em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.06em;"></span></span></span></span><span class="mo" id="MathJax-Span-23105" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.599em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.753em; vertical-align: -0.497em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5040">(\frac{k}{t})</script>, 选中而且取代原来 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5041-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23106" style="width: 0.387em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.291em; height: 0px; font-size: 130%;"><span style="position: absolute; clip: rect(1.781em 1000.002em 2.743em -0.382em); top: -2.594em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23107"><span class="mi" id="MathJax-Span-23108" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.599em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.003em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5041">i</script> 所在的位置的概率即是 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5042-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23109" style="width: 1.829em; display: inline-block;"><span style="display: inline-block; position: relative; width: 1.397em; height: 0px; font-size: 130%;"><span style="position: absolute; clip: rect(1.108em 1000.002em 3.127em -0.382em); top: -2.594em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23110"><span class="mo" id="MathJax-Span-23111" style="font-family: STIXGeneral-Regular;">(</span><span class="mfrac" id="MathJax-Span-23112" style="padding-left: 0.099em; padding-right: 0.099em;"><span style="display: inline-block; position: relative; width: 0.483em; height: 0px;"><span style="position: absolute; clip: rect(3.175em 1000.002em 4.377em -0.43em); top: -4.661em; left: 50%; margin-left: -0.19em;"><span class="mfrac" id="MathJax-Span-23113" style="padding-left: 0.099em; padding-right: 0.099em;"><span style="display: inline-block; position: relative; width: 0.339em; height: 0px;"><span style="position: absolute; clip: rect(2.07em 1000.002em 2.695em -0.43em); top: -2.882em; left: 50%; margin-left: -0.094em;"><span class="mi" id="MathJax-Span-23114" style="font-size: 50%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.55em;"></span></span><span style="position: absolute; clip: rect(2.118em 1000.002em 2.695em -0.43em); top: -2.305em; left: 50%; margin-left: -0.094em;"><span class="mi" id="MathJax-Span-23115" style="font-size: 50%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.55em;"></span></span><span style="position: absolute; clip: rect(0.868em 1000.002em 1.204em -0.43em); top: -1.2em; left: 0.002em;"><span style="border-left-width: 0.339em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.06em;"></span></span></span></span><span style="display: inline-block; width: 0px; height: 3.993em;"></span></span><span style="position: absolute; clip: rect(1.925em 1000.002em 2.695em -0.43em); top: -2.161em; left: 50%; margin-left: -0.19em;"><span class="mi" id="MathJax-Span-23116" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.55em;"></span></span><span style="position: absolute; clip: rect(0.868em 1000.002em 1.204em -0.43em); top: -1.296em; left: 0.002em;"><span style="border-left-width: 0.483em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.06em;"></span></span></span></span><span class="mo" id="MathJax-Span-23117" style="font-family: STIXGeneral-Regular;">)</span></span><span style="display: inline-block; width: 0px; height: 2.599em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.378em; vertical-align: -0.559em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5042">(\frac{\frac{k}{t}}{k})</script></strong>. 所以后面任意一个实例不取代 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5043-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23118" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23119"><span class="mi" id="MathJax-Span-23120" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5043">i</script> 的概率就是 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5044-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23121" style="width: 3.028em; display: inline-block;"><span style="display: inline-block; position: relative; width: 2.383em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.491em 1000.002em 3.028em -0.345em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23122"><span class="mn" id="MathJax-Span-23123" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-23124" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mfrac" id="MathJax-Span-23125" style="padding-left: 0.35em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 0.449em; height: 0px;"><span style="position: absolute; clip: rect(1.838em 1000.002em 2.631em -0.345em); top: -2.875em; left: 50%; margin-left: -0.146em;"><span class="mn" id="MathJax-Span-23126" style="font-size: 70.7%; font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span><span style="position: absolute; clip: rect(1.937em 1000.002em 2.631em -0.394em); top: -2.13em; left: 50%; margin-left: -0.097em;"><span class="mi" id="MathJax-Span-23127" style="font-size: 70.7%; font-family: STIXGeneral-Italic;">t<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.483em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.238em; left: 0.002em;"><span style="border-left-width: 0.449em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.691em; vertical-align: -0.497em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5044">1-\frac{1}{t}</script>, 那么要所有的的情况都发生, 最后 <span class="MathJax_Preview"></span><span class="MathJax" id="MathJax-Element-5045-Frame" role="textbox" aria-readonly="true"><nobr><span class="math" id="MathJax-Span-23128" style="width: 0.399em; display: inline-block;"><span style="display: inline-block; position: relative; width: 0.3em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.739em 1000.002em 2.681em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23129"><span class="mi" id="MathJax-Span-23130" style="font-family: STIXGeneral-Italic;">i</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 0.941em; vertical-align: -0.059em;"></span></span></nobr></span><script type="math/tex" id="MathJax-Element-5045">i</script> 才能留在result中, 这样就是一个连乘的结果: <br>
<span class="MathJax_Preview"></span><div class="MathJax_Display" role="textbox" aria-readonly="true" style="text-align: center;"><span class="MathJax" id="MathJax-Element-5046-Frame"><nobr><span class="math" id="MathJax-Span-23131" style="width: 25.647em; display: inline-block;"><span style="display: inline-block; position: relative; width: 20.34em; height: 0px; font-size: 126%;"><span style="position: absolute; clip: rect(1.044em 1000.002em 3.425em -0.394em); top: -2.527em; left: 0.002em;"><span class="mrow" id="MathJax-Span-23132"><span class="mo" id="MathJax-Span-23133" style="font-family: STIXGeneral-Regular;">(</span><span class="mfrac" id="MathJax-Span-23134" style="padding-left: 0.102em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.444em); top: -3.222em; left: 50%; margin-left: -0.246em;"><span class="mi" id="MathJax-Span-23135" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(1.739em 1000.002em 2.681em -0.394em); top: -1.833em; left: 50%; margin-left: -0.146em;"><span class="mi" id="MathJax-Span-23136" style="font-family: STIXGeneral-Italic;">i</span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.238em; left: 0.002em;"><span style="border-left-width: 0.598em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-23137" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-23138" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mo" id="MathJax-Span-23139" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mn" id="MathJax-Span-23140" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-23141" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mfrac" id="MathJax-Span-23142" style="padding-left: 0.35em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.345em); top: -3.222em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-23143" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(1.689em 1000.002em 2.731em -0.394em); top: -1.833em; left: 50%; margin-left: -0.99em;"><span class="mrow" id="MathJax-Span-23144"><span class="mi" id="MathJax-Span-23145" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-23146" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mn" id="MathJax-Span-23147" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">1</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.238em; left: 0.002em;"><span style="border-left-width: 2.086em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-23148" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-23149" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">∗</span><span class="mo" id="MathJax-Span-23150" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">(</span><span class="mn" id="MathJax-Span-23151" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-23152" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mfrac" id="MathJax-Span-23153" style="padding-left: 0.35em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 2.086em; height: 0px;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.345em); top: -3.222em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-23154" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(1.689em 1000.002em 2.731em -0.394em); top: -1.833em; left: 50%; margin-left: -0.99em;"><span class="mrow" id="MathJax-Span-23155"><span class="mi" id="MathJax-Span-23156" style="font-family: STIXGeneral-Italic;">i</span><span class="mo" id="MathJax-Span-23157" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">+</span><span class="mn" id="MathJax-Span-23158" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">2</span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.238em; left: 0.002em;"><span style="border-left-width: 2.086em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-23159" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-23160" style="font-family: STIXGeneral-Regular;">.</span><span class="mo" id="MathJax-Span-23161" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">.</span><span class="mo" id="MathJax-Span-23162" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">.</span><span class="mo" id="MathJax-Span-23163" style="font-family: STIXGeneral-Regular; padding-left: 0.201em;">∗</span><span class="mo" id="MathJax-Span-23164" style="font-family: STIXGeneral-Regular;">(</span><span class="mn" id="MathJax-Span-23165" style="font-family: STIXGeneral-Regular;">1</span><span class="mo" id="MathJax-Span-23166" style="font-family: STIXGeneral-Regular; padding-left: 0.25em;">−</span><span class="mfrac" id="MathJax-Span-23167" style="padding-left: 0.35em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.345em); top: -3.222em; left: 50%; margin-left: -0.246em;"><span class="mn" id="MathJax-Span-23168" style="font-family: STIXGeneral-Regular;">1</span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(1.937em 1000.002em 2.681em -0.444em); top: -1.833em; left: 50%; margin-left: -0.246em;"><span class="mi" id="MathJax-Span-23169" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.238em; left: 0.002em;"><span style="border-left-width: 0.598em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span><span class="mo" id="MathJax-Span-23170" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-23171" style="font-family: STIXGeneral-Regular;">)</span><span class="mo" id="MathJax-Span-23172" style="font-family: STIXGeneral-Regular; padding-left: 0.3em;">=</span><span class="mfrac" id="MathJax-Span-23173" style="padding-left: 0.449em; padding-right: 0.102em;"><span style="display: inline-block; position: relative; width: 0.598em; height: 0px;"><span style="position: absolute; clip: rect(1.689em 1000.002em 2.681em -0.444em); top: -3.222em; left: 50%; margin-left: -0.246em;"><span class="mi" id="MathJax-Span-23174" style="font-family: STIXGeneral-Italic;">k<span style="display: inline-block; overflow: hidden; height: 1px; width: 0.002em;"></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(1.937em 1000.002em 2.681em -0.444em); top: -1.833em; left: 50%; margin-left: -0.246em;"><span class="mi" id="MathJax-Span-23175" style="font-family: STIXGeneral-Italic;">n</span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span><span style="position: absolute; clip: rect(0.846em 1000.002em 1.193em -0.444em); top: -1.238em; left: 0.002em;"><span style="border-left-width: 0.598em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 1.25px; vertical-align: 0.002em;"></span><span style="display: inline-block; width: 0px; height: 1.044em;"></span></span></span></span></span><span style="display: inline-block; width: 0px; height: 2.532em;"></span></span></span><span style="border-left-width: 0.003em; border-left-style: solid; display: inline-block; overflow: hidden; width: 0px; height: 2.753em; vertical-align: -0.997em;"></span></span></nobr></span></div><script type="math/tex; mode=display" id="MathJax-Element-5046">(\frac{k}{i}) * (1 - \frac{1}{i+1}) * (1 - \frac{1}{i+2})...*(1 - \frac{1}{n})) = \frac{k}{n}</script></p>

<div class="md-section-divider"></div>

<h3 id="4-java-代码">4. Java 代码</h3>

<div class="md-section-divider"></div>

<pre class="prettyprint linenums prettyprinted"><ol class="linenums"><li class="L0"><code class="language-Java"><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> reservoirSampling</span><span class="pun">(</span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> data</span><span class="pun">,</span><span class="pln"> </span><span class="kwd">int</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L1"><code class="language-Java"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">data </span><span class="pun">==</span><span class="pln"> </span><span class="kwd">null</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-Java"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span></code></li><li class="L3"><code class="language-Java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4"><code class="language-Java"></code></li><li class="L5"><code class="language-Java"><span class="pln">        </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">data</span><span class="pun">.</span><span class="pln">length </span><span class="pun">&lt;</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-Java"><span class="pln">            </span><span class="kwd">return</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[</span><span class="lit">0</span><span class="pun">];</span></code></li><li class="L7"><code class="language-Java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L8"><code class="language-Java"></code></li><li class="L9"><code class="language-Java"><span class="pln">        </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> sample </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[</span><span class="pln">k</span><span class="pun">];</span></code></li><li class="L0"><code class="language-Java"><span class="pln">        </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">.</span><span class="pln">length</span><span class="pun">;</span></code></li><li class="L1"><code class="language-Java"></code></li><li class="L2"><code class="language-Java"><span class="pln">        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L3"><code class="language-Java"><span class="pln">            </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">i </span><span class="pun">&lt;</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L4"><code class="language-Java"><span class="pln">                sample</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></code></li><li class="L5"><code class="language-Java"><span class="pln">            </span><span class="pun">}</span><span class="pln"> </span><span class="kwd">else</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L6"><code class="language-Java"><span class="pln">                </span><span class="kwd">int</span><span class="pln"> j </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="typ">Random</span><span class="pun">().</span><span class="pln">nextInt</span><span class="pun">(</span><span class="pln">i</span><span class="pun">);</span></code></li><li class="L7"><code class="language-Java"><span class="pln">                </span><span class="kwd">if</span><span class="pln"> </span><span class="pun">(</span><span class="pln">j </span><span class="pun">&lt;</span><span class="pln"> k</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L8"><code class="language-Java"><span class="pln">                    sample</span><span class="pun">[</span><span class="pln">j</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> data</span><span class="pun">[</span><span class="pln">i</span><span class="pun">];</span></code></li><li class="L9"><code class="language-Java"><span class="pln">                </span><span class="pun">}</span></code></li><li class="L0"><code class="language-Java"><span class="pln">            </span><span class="pun">}</span></code></li><li class="L1"><code class="language-Java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L2"><code class="language-Java"><span class="pln">        </span><span class="kwd">return</span><span class="pln"> sample</span><span class="pun">;</span></code></li><li class="L3"><code class="language-Java"></code></li><li class="L4"><code class="language-Java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L5"><code class="language-Java"></code></li><li class="L6"><code class="language-Java"><span class="pln">    </span><span class="kwd">public</span><span class="pln"> </span><span class="kwd">static</span><span class="pln"> </span><span class="kwd">void</span><span class="pln"> main</span><span class="pun">(</span><span class="typ">String</span><span class="pun">[]</span><span class="pln"> args</span><span class="pun">)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L7"><code class="language-Java"><span class="pln">        </span><span class="kwd">int</span><span class="pln"> k </span><span class="pun">=</span><span class="pln"> </span><span class="lit">100</span><span class="pun">;</span></code></li><li class="L8"><code class="language-Java"><span class="pln">        </span><span class="kwd">int</span><span class="pln"> n </span><span class="pun">=</span><span class="pln"> </span><span class="lit">1000</span><span class="pun">;</span></code></li><li class="L9"><code class="language-Java"></code></li><li class="L0"><code class="language-Java"><span class="pln">        </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> data </span><span class="pun">=</span><span class="pln"> </span><span class="kwd">new</span><span class="pln"> </span><span class="kwd">int</span><span class="pun">[</span><span class="pln">n</span><span class="pun">];</span></code></li><li class="L1"><code class="language-Java"><span class="pln">        </span><span class="kwd">for</span><span class="pln"> </span><span class="pun">(</span><span class="kwd">int</span><span class="pln"> i </span><span class="pun">=</span><span class="pln"> </span><span class="lit">0</span><span class="pun">;</span><span class="pln"> i </span><span class="pun">&lt;</span><span class="pln"> n</span><span class="pun">;</span><span class="pln"> i</span><span class="pun">++)</span><span class="pln"> </span><span class="pun">{</span></code></li><li class="L2"><code class="language-Java"><span class="pln">            data</span><span class="pun">[</span><span class="pln">i</span><span class="pun">]</span><span class="pln"> </span><span class="pun">=</span><span class="pln"> i</span><span class="pun">;</span></code></li><li class="L3"><code class="language-Java"><span class="pln">        </span><span class="pun">}</span></code></li><li class="L4"><code class="language-Java"></code></li><li class="L5"><code class="language-Java"><span class="pln">        </span><span class="kwd">int</span><span class="pun">[]</span><span class="pln"> sample </span><span class="pun">=</span><span class="pln"> reservoirSampling</span><span class="pun">(</span><span class="pln">data</span><span class="pun">,</span><span class="pln"> k</span><span class="pun">);</span></code></li><li class="L6"><code class="language-Java"><span class="pln">        </span><span class="typ">System</span><span class="pun">.</span><span class="kwd">out</span><span class="pun">.</span><span class="pln">println</span><span class="pun">(</span><span class="typ">Arrays</span><span class="pun">.</span><span class="pln">toString</span><span class="pun">(</span><span class="pln">sample</span><span class="pun">));</span></code></li><li class="L7"><code class="language-Java"><span class="pln">    </span><span class="pun">}</span></code></li><li class="L8"><code class="language-Java"></code></li></ol></pre>
</body>
</html>